<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moderation Panel - <%= guild.name %></title>
    <link rel="stylesheet" href="/style.css">
    <style>
        .mod-container { max-width: 1200px; margin: 40px auto; padding: 20px; }
        .mod-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .mod-tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid var(--border-color); }
        .mod-tab { padding: 12px 24px; cursor: pointer; border: none; background: none; color: var(--text-color); font-size: 16px; transition: all 0.3s; }
        .mod-tab.active { border-bottom: 3px solid #5865F2; color: #5865F2; font-weight: bold; }
        .mod-tab:hover { background: var(--card-secondary); }
        .mod-panel { display: none; }
        .mod-panel.active { display: block; }
        .mod-table { width: 100%; border-collapse: collapse; background: var(--card-bg); box-shadow: 0 2px 10px var(--shadow); border: 1px solid var(--border-color); }
        .mod-table th, .mod-table td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); color: var(--text-color); }
        .mod-table th { background: #5865F2; color: white; font-weight: bold; }
        .mod-table tr:hover { background: var(--card-secondary); }
        .action-btn { padding: 6px 12px; margin: 0 4px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: all 0.3s; }
        .btn-remove { background: #ED4245; color: white; }
        .btn-remove:hover { background: #c13639; }
        .btn-unban { background: #57F287; color: white; }
        .btn-unban:hover { background: #45c06d; }
        .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        .filter-bar input, .filter-bar select { padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; background: var(--input-bg); color: var(--text-color); }
        .filter-bar input { flex: 1; }
        .add-warning-form { background: var(--card-bg); padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px var(--shadow); border: 1px solid var(--border-color); margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; color: var(--text-color); }
        .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; background: var(--input-bg); color: var(--text-color); }
        .form-group textarea { resize: vertical; min-height: 80px; }
        .btn-primary { background: #5865F2; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn-primary:hover { background: #4752c4; }
        .no-data { text-align: center; padding: 40px; color: var(--text-light); font-size: 18px; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .badge-warn { background: #FEE75C; color: #000; }
        .badge-ban { background: #ED4245; color: white; }
        .badge-kick { background: #F26522; color: white; }
        .badge-timeout { background: #EB459E; color: white; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>üõ°Ô∏è <%= guild.name %> - Moderation Panel</h1>
            </div>
            <div class="nav-links">
                <a href="/dashboard/<%= guild.id %>" class="btn-back">‚Üê Back to Dashboard</a>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <!-- Quick Navigation -->
        <div class="quick-nav">
            <a href="/dashboard/<%= guild.id %>" class="nav-btn">‚öôÔ∏è Settings</a>
            <a href="/dashboard/<%= guild.id %>/economy" class="nav-btn">üí∞ Economy</a>
            <a href="/dashboard/<%= guild.id %>/moderation" class="nav-btn active">üõ°Ô∏è Moderation</a>
            <a href="/dashboard/<%= guild.id %>/automod" class="nav-btn">ü§ñ Auto-Mod</a>
            <a href="/dashboard/<%= guild.id %>/shop" class="nav-btn">üõí Shop</a>
        </div>

    <div class="mod-container">
        <div class="mod-header">
            <h2>Moderation Management</h2>
        </div>

        <div class="mod-tabs">
            <button class="mod-tab active" onclick="switchTab('warnings')">Warnings</button>
            <button class="mod-tab" onclick="switchTab('bans')">Bans</button>
            <button class="mod-tab" onclick="switchTab('kicks')">Kicks</button>
            <button class="mod-tab" onclick="switchTab('timeouts')">Timeouts</button>
        </div>

        <!-- Warnings Panel -->
        <div id="warnings" class="mod-panel active">
            <div class="add-warning-form">
                <h3>Add Warning</h3>
                <form id="addWarningForm">
                    <div class="form-group">
                        <label>User ID</label>
                        <input type="text" name="userId" placeholder="Enter user ID" required>
                    </div>
                    <div class="form-group">
                        <label>Reason</label>
                        <textarea name="reason" placeholder="Enter warning reason" required></textarea>
                    </div>
                    <button type="submit" class="btn-primary">Add Warning</button>
                </form>
            </div>

            <div class="filter-bar">
                <input type="text" id="warningsSearch" placeholder="Search by user or reason..." onkeyup="filterTable('warningsTable', this.value)">
            </div>

            <table class="mod-table" id="warningsTable">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>User ID</th>
                        <th>Reason</th>
                        <th>Moderator</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (warnings && warnings.length > 0) { %>
                        <% warnings.forEach(warning => { %>
                            <tr>
                                <td><span class="badge badge-warn">‚ö†Ô∏è</span> <%= warning.username || 'Unknown' %></td>
                                <td><code><%= warning.userId %></code></td>
                                <td><%= warning.reason %></td>
                                <td><%= warning.moderator || 'System' %></td>
                                <td><%= new Date(warning.timestamp).toLocaleDateString() %></td>
                                <td>
                                    <button class="action-btn btn-remove" onclick="removeWarning('<%= warning.userId %>', '<%= warning.id %>')">Remove</button>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="6" class="no-data">No warnings found</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Bans Panel -->
        <div id="bans" class="mod-panel">
            <div class="filter-bar">
                <input type="text" id="bansSearch" placeholder="Search banned users..." onkeyup="filterTable('bansTable', this.value)">
            </div>

            <table class="mod-table" id="bansTable">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>User ID</th>
                        <th>Reason</th>
                        <th>Moderator</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (bans && bans.length > 0) { %>
                        <% bans.forEach(ban => { %>
                            <tr>
                                <td><span class="badge badge-ban">üö´</span> <%= ban.user.username %>#<%= ban.user.discriminator %></td>
                                <td><code><%= ban.user.id %></code></td>
                                <td><%= ban.reason || 'No reason provided' %></td>
                                <td><%= ban.moderator || 'Unknown' %></td>
                                <td><%= new Date(ban.timestamp || Date.now()).toLocaleDateString() %></td>
                                <td>
                                    <button class="action-btn btn-unban" onclick="unbanUser('<%= ban.user.id %>')">Unban</button>
                                </td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="6" class="no-data">No bans found</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Kicks Panel -->
        <div id="kicks" class="mod-panel">
            <table class="mod-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Reason</th>
                        <th>Moderator</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (kicks && kicks.length > 0) { %>
                        <% kicks.forEach(kick => { %>
                            <tr>
                                <td><span class="badge badge-kick">üë¢</span> <%= kick.username %></td>
                                <td><%= kick.reason %></td>
                                <td><%= kick.moderator %></td>
                                <td><%= new Date(kick.timestamp).toLocaleDateString() %></td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="4" class="no-data">No kicks recorded</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Timeouts Panel -->
        <div id="timeouts" class="mod-panel">
            <table class="mod-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Duration</th>
                        <th>Reason</th>
                        <th>Moderator</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (timeouts && timeouts.length > 0) { %>
                        <% timeouts.forEach(timeout => { %>
                            <tr>
                                <td><span class="badge badge-timeout">‚è±Ô∏è</span> <%= timeout.username %></td>
                                <td><%= timeout.duration %> min</td>
                                <td><%= timeout.reason %></td>
                                <td><%= timeout.moderator %></td>
                                <td><%= new Date(timeout.timestamp).toLocaleDateString() %></td>
                            </tr>
                        <% }) %>
                    <% } else { %>
                        <tr><td colspan="5" class="no-data">No timeouts recorded</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.mod-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.mod-panel').forEach(panel => panel.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function filterTable(tableId, searchValue) {
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName('tr');
            
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchValue.toLowerCase()) ? '' : 'none';
            }
        }

        document.getElementById('addWarningForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/api/<%= guild.id %>/moderation/warnings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                if (response.ok) {
                    alert('Warning added successfully!');
                    location.reload();
                } else {
                    alert('Failed to add warning');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        });

        async function removeWarning(userId, warningId) {
            if (!confirm('Are you sure you want to remove this warning?')) return;
            
            try {
                const response = await fetch('/api/<%= guild.id %>/moderation/warnings/' + userId + '/' + warningId, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('Warning removed!');
                    location.reload();
                } else {
                    alert('Failed to remove warning');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function unbanUser(userId) {
            if (!confirm('Are you sure you want to unban this user?')) return;
            
            try {
                const response = await fetch('/api/<%= guild.id %>/moderation/unban', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId })
                });
                
                if (response.ok) {
                    alert('User unbanned!');
                    location.reload();
                } else {
                    alert('Failed to unban user');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
